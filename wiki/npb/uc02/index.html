
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../uc01/">
      
      
      
      <link rel="icon" href="../None">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Use case 02 - Papyrus4Manufacturing for ROS6GBridge</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../styles/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#use-case-02-waterfall" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Papyrus4Manufacturing for ROS6GBridge" class="md-header__button md-logo" aria-label="Papyrus4Manufacturing for ROS6GBridge" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Papyrus4Manufacturing for ROS6GBridge
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Use case 02
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Papyrus4Manufacturing for ROS6GBridge" class="md-nav__button md-logo" aria-label="Papyrus4Manufacturing for ROS6GBridge" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Papyrus4Manufacturing for ROS6GBridge
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IDE Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AAS Model design
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../gennpb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software NPB generation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../genaas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NPB Digital Twin generation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../uc01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use case 01
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Use case 02
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Use case 02
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-instructions" class="md-nav__link">
    Deployment Instructions
  </a>
  
    <nav class="md-nav" aria-label="Deployment Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-download-and-load-docker-files" class="md-nav__link">
    Step 1: Download and Load Docker files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-run-docker-for-stairs" class="md-nav__link">
    Step 2: Run Docker for stairs
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Run Docker for stairs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-modbus-tcp-stair" class="md-nav__link">
    a. Modbus TCP stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-opc-ua-fx-stair" class="md-nav__link">
    b. OPC UA FX stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-ros2-stair" class="md-nav__link">
    c. ROS2 stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-ethernetip-stair" class="md-nav__link">
    d. EtherNet/IP stair
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-run-npb-docker" class="md-nav__link">
    Step 3: Run NPB Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-trigger-a-stair" class="md-nav__link">
    Step 4: Trigger a stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonus-canopen-sdo" class="md-nav__link">
    (Bonus) CANOpen SDO
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-instructions" class="md-nav__link">
    Deployment Instructions
  </a>
  
    <nav class="md-nav" aria-label="Deployment Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-download-and-load-docker-files" class="md-nav__link">
    Step 1: Download and Load Docker files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-run-docker-for-stairs" class="md-nav__link">
    Step 2: Run Docker for stairs
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Run Docker for stairs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-modbus-tcp-stair" class="md-nav__link">
    a. Modbus TCP stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-opc-ua-fx-stair" class="md-nav__link">
    b. OPC UA FX stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-ros2-stair" class="md-nav__link">
    c. ROS2 stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-ethernetip-stair" class="md-nav__link">
    d. EtherNet/IP stair
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-run-npb-docker" class="md-nav__link">
    Step 3: Run NPB Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-trigger-a-stair" class="md-nav__link">
    Step 4: Trigger a stair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonus-canopen-sdo" class="md-nav__link">
    (Bonus) CANOpen SDO
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="use-case-02-waterfall">Use Case 02: Waterfall</h1>
<p>Waterfall is a educative use case with a simple concept and 
easy to reproduce. 
It was first deployed in the LocalSEA testbed of CEA List, 
then its components was dockerized using Docker to be able to test 
in other environments. </p>
<hr />
<h3 id="description">Description</h3>
<p>Given a waterfall consisted of multiple stairs. 
When pouring the water into a stair, the water will go down 
stair-by-stair until the final one. 
The use case mimic the mechanism of the waterfall. 
Figure 1 illustrates this concept. </p>
<div align="center">       
  <figure style="display: inline-block; margin: 0 10px;">                       
    <img src="../images/uc02ctx.jpg" alt="download" 
        style="width: 40vw; max-width: 900px;"/>
    <figcaption style="text-align: center;">                                    
      Figure 1. Illustration of the waterfall concept 
    </figcaption> 
  </figure>                                                                     
</div>

<p>There are five software components using five network protocols: 
CANopen, Modbus TCP, OPC UA FX, ROS 2, and EtherNet/IP Class 1, 
represent five stairs of the waterfall. 
When a trigger send a message to a stair, it will trigger its 
lower stair by sending a message to this lower one. 
For example, when the stair OPC UA FX is triggered, it will trigger 
the stair ROS 2; then, the stair ROS 2 will trigger the stair EtherNet/IP.  </p>
<h3 id="deployment-instructions">Deployment Instructions</h3>
<p>Figure 2 shows the topology of the waterfall use case. 
There are seven components: the NPB, five components for five stair 
applications using the five protocols, and a component running as 
the trigger. The trigger and the five stairs connect to the NPB. 
All components are containerized into Docker images. 
To ease the deployment, the Docker images for both amd64 and arm64 are prepared in <a href="https://github.com/pkgi40/p4m-projects/releases/download/ros6gbridge_uc02_kit_v0.1/UC02_kit.zip">ROS6GBridge UC02 kit</a>.<br />
</p>
<div align="center">       
  <figure style="display: inline-block; margin: 0 10px;">                       
    <img src="../images/uc02topo.jpg" alt="download" 
        style="width: 40vw; max-width: 900px;"/>
    <figcaption style="text-align: center;">                                    
      Figure 2. Topology of the waterfall use case
    </figcaption> 
  </figure>                                                                     
</div>

<p><span style="color:#2196f3; font-style:italic;">
<u>Note:</u> The official version of this use case supports only four 
lastest stairs. 
The <strong style="color:#2196f3">CAN Open</strong> stair will be put as a 
bonus. 
</span></p>
<p>This use case requires at least two devices, for example, 
one computer (amd64) and one Raspberry Pi (arm64). 
While the first device runs NPB and the trigger, the second runs the stairs. 
Figure 3 illustrates the AAS information model that is used to generate 
bridge NPB. </p>
<div align="center">       
  <figure style="display: inline-block; margin: 0 10px;">    
    <img src="../images/uc02aas.jpg" alt="download"
        style="width: 40vw; max-width: 900px;"/>
    <figcaption style="text-align: center;">       
      Figure 3. The AAS information model of bridge NPB
    </figcaption> 
  </figure>        
</div>

<p>The four basic steps are as follows.    </p>
<h4 id="step-1-download-and-load-docker-files">Step 1: Download and Load Docker files</h4>
<p>User can download the <a href="https://github.com/pkgi40/p4m-projects/releases/download/ros6gbridge_uc02_kit_v0.1/UC02_kit.zip">ROS6GBridge UC02 kit</a>, then extract it using the command:  </p>
<blockquote>
<p>$ <code>unzip UC02_kit.zip</code></p>
</blockquote>
<p>User need to copy all arm64 files (file with <em>arm</em> in name) to the device 
using architecture arm64. The other files are for amd64.    </p>
<p>Each device needs to load its corresponding docker images. In this example, 
the computer load NPB and Trigger docker images:   </p>
<blockquote>
<p>$ <code>docker load -i npb_brx_img.tar.gz</code><br />
$ <code>docker load -i pourer_mtcp_img.tar.gz</code>  </p>
</blockquote>
<p>and the Raspberry Pi loads the docker images of stairs:  </p>
<blockquote>
<p>$ <code>docker load -i stair_mtcp_img_arm.tar.gz</code><br />
$ <code>docker load -i stair_uafx_img_arm.tar.gz</code><br />
$ <code>docker load -i stair_ros2_img_arm.tar.gz</code><br />
$ <code>docker load -i stair_eip_img_arm.tar.gz</code>  </p>
</blockquote>
<h4 id="step-2-run-docker-for-stairs">Step 2: Run Docker for stairs</h4>
<p>Each stair may need a specific configuration to run properly. </p>
<h5 id="a-modbus-tcp-stair">a. Modbus TCP stair</h5>
<p>Modbus TCP stair requires the address of NPB bridge as input. For example, 
the address of NPB bridge is <em>192.168.56.11</em>. Run the following command:  </p>
<blockquote>
<p>$ <code>docker run -it --net=host --rm stair_mtcp:0.2.arm /app 192.168.56.11</code>  </p>
</blockquote>
<p>The expected successful output is <code>Server MODBUSTCP: port 502</code> showing that 
the Modbus TCP stair is listening at port <em>502</em>.   </p>
<h5 id="b-opc-ua-fx-stair">b. OPC UA FX stair</h5>
<p>OPC UA FX stair requires the network interface that connect to the bridge 
as input. For example, the network interface is <em>eth0</em>. 
Run the following command:  </p>
<blockquote>
<p>$ <code>docker run -it --net=host --cap-add=NET_ADMIN --rm stair_uafx:0.2.arm /app eth0</code>  </p>
</blockquote>
<p>The expected successful output is <code>Server OPC UA FX: port 4801</code> showing 
that the OPC UA FX stair is listening at port <em>4801</em>.   </p>
<h5 id="c-ros2-stair">c. ROS2 stair</h5>
<p>ROS2 stair requires some input parameters. Run the following command:  </p>
<blockquote>
<p>$ <code>docker run -it --net=host --rm stair_ros2:0.2.arm /bin/bash -c "export ROS_DOMAIN_ID=0 &amp;&amp; source /opt/ros/humble/setup.bash &amp;&amp; source /workspace/install/setup.bash &amp;&amp; ros2 run stair led_waterfall"</code>  </p>
</blockquote>
<p>The expected successful output is <code>Server ROS2: ROS_DOMAIN_ID=0</code>.</p>
<h5 id="d-ethernetip-stair">d. EtherNet/IP stair</h5>
<p>EtherNet/IP stair requires the network interface that connect to the bridge 
as input. For example, the network interface is <em>eth0</em>. 
Run the following command:  </p>
<blockquote>
<p>$ <code>docker run -it --net=host --rm stair_eip:0.2.arm /app eth0</code>   </p>
</blockquote>
<p>The expected successful output is <code>Server EtherNet/IP: port 2222</code> showing that 
the EtherNet/IP stair is listening at port <em>2222</em>.     </p>
<h4 id="step-3-run-npb-docker">Step 3: Run NPB Docker</h4>
<p>Users need to create a configuration file <em>application.properties</em> which is 
the input for the NPB Docker. In this example, the address of the 
Raspberry Pi is <em>192.168.56.13</em> and the network interface for the connection 
with it is <em>eth0</em>. The content of the file is as follows. </p>
<blockquote>
<p><code>app.name=npb_brxfpga</code><br />
<code>app.version=v1.0</code><br />
<code>app.sdn.agent.interface=eth0</code><br />
<code>app.sdn.agent.endpoint=ws://192.168.56.11:8080</code><br />
<code>ros2.interface=eth0</code><br />
<code>ros2.domain.id=0</code><br />
<code>modbustcp.interface=eth0</code><br />
<code>modbustcp.endpoint=modbus-tcp://192.168.56.13:502</code><br />
<code>ethernetip.interface=eth0</code><br />
<code>ethernetip.endpoint=eip-tcp://192.168.56.13:44818</code><br />
<code>ethernetip.data.endpoint=eip-udp://192.168.56.13:2222</code><br />
<code>ethernetip.to.connection.point=100</code><br />
<code>ethernetip.to.elements.range=32</code><br />
<code>ethernetip.ot.connection.point=150</code><br />
<code>ethernetip.ot.elements.range=32</code><br />
<code>uafx.interface=eth0</code><br />
<code>uafx.multicast.endpoint=udp://224.0.0.1:4801</code>  </p>
</blockquote>
<p>Run NPB bridge using the following command:   </p>
<blockquote>
<p><code>cat application.properties | docker run -i --rm --net=host --cap-add=NET_ADMIN npb_brx:0.4 bash -c "tee application.properties &amp;&amp; java -jar app.jar"</code></p>
</blockquote>
<p>The expected successful output is <code>=========== BRx ON</code> with errors 
displayed on the prompt. </p>
<h4 id="step-4-trigger-a-stair">Step 4: Trigger a stair</h4>
<p>A stair can be triggered using Pourer Docker. 
The trigger needs three inputs which are: <br />
- Address of the bridge: in this example, it is <em>192.168.56.11</em>.<br />
- Unit identifier of the stair: 41 (Modbus TCP), 96 (OPC UA FX), 31 (ROS2), 
or 60(EtherNet/IP). <br />
- Value: 0 (false) or 1 (true).   </p>
<p>Figure 4 shows the result after triggering the stair Modbus TCP with the 
following command:  </p>
<blockquote>
<p>$ <code>docker run -it --net=host --rm pourer_mtcp:0.1 /app 192.168.56.11 41 1</code>   </p>
</blockquote>
<div align="center">       
  <figure style="display: inline-block; margin: 0 10px;">    
    <img src="../images/poureroutput.jpg" alt="download" style="width: 100%;"/>
    <figcaption style="text-align: center;">       
      Figure 4. Output when triggering stair Modbus TCP 
    </figcaption> 
  </figure>        
</div>

<p><span style="color:#2196f3; font-style:italic;">
<u>Note:</u> All stairs will be triggered once except stair 
<strong style="color:#2196f3">EtherNet/IP</strong> which will be loop. 
The loop of this last stair can only be stopped by triggering it with the 
value <strong style="color:#2196f3">False</strong>.
</span></p>
<h4 id="bonus-canopen-sdo">(Bonus) CANOpen SDO</h4>
<p>CANOpen is a protocol for CAN bus. 
Thus, it does not work with Ethernet natively. 
To test a CAN bus communication, there are two solutions. 
First, it requires a module to convert from one socket type to CAN bus. 
For example, it is <em>MCP2515 CAN Controller</em> in the case of Raspberry Pi. 
Second, it is possible to use a software tunnel running in the two ends 
of the communication. 
In both cases, users must raise the vcan interface with the following 
commands:  </p>
<blockquote>
<p>$ <code>sudo modprobe vcan</code><br />
$ <code>sudo ip link add dev vcan0 type vcan</code><br />
$ <code>sudo ip link set vcan0 mtu 16</code><br />
$ <code>sudo ip link set up vcan0</code>  </p>
</blockquote>
<p>The following is content of <em>tunnel.py</em> running on the computer. </p>
<pre><code>#!/usr/bin/python3

import can, socket, json
import threading
import signal
import os

def signal_handler(sig, frame):
  os._exit(0)

signal.signal(signal.SIGINT,signal_handler)

bus = can.interface.Bus(channel='vcan0', interface='socketcan')
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

SRC_PORT = 8811
SRC_ADDR = &quot;0.0.0.0&quot;
DES_PORT = 8813
DES_ADDR = &quot;192.168.56.13&quot;

def forward_data():
  while True:
    msg = bus.recv()
    data = json.dumps({'arbitration_id': msg.arbitration_id,
      'data': list(msg.data),'is_extended_id': msg.is_extended_id}).encode()
    sock.sendto(data, (DES_ADDR, DES_PORT))

thread = threading.Thread(target=forward_data)
thread.start()

sock.bind((SRC_ADDR, SRC_PORT))
while True:
  data, _ = sock.recvfrom(1024)
  msg_data = json.loads(data.decode())
  msg = can.Message(
    arbitration_id=msg_data['arbitration_id'],
    data=msg_data['data'],
    is_extended_id=msg_data['is_extended_id']
  )
  bus.send(msg)
</code></pre>
<p><span style="color:#2196f3; font-style:italic;">
<u>Note:</u> For the 
<strong style="color:#2196f3">tunnel.py</strong> running on Raspberry Pi,
it is necessary to change the values of 
<strong style="color:#2196f3">SRC_PORT</strong>, 
<strong style="color:#2196f3">DES_PORT</strong>, and 
<strong style="color:#2196f3">DES_ADDR</strong>.<br />
</span></p>
<p>After establishing the CAN over Ethernet channel, 
the CAN data communication is ready. 
The CANOpen implemented in this test follows the simpliest CANOpen 
<a href="https://eclipse.dev/papyrus/components/manufacturing/">Service Data Object</a> 
(SDO) mapping. 
Figure 5 illustrates the new AAS information model of bridge NPB including 
CANOpen. In detail, a new interface <code>canopen</code> and a new routing node 
<code>brx_70_1_1</code> are added. </p>
<div align="center">       
  <figure style="display: inline-block; margin: 0 10px;">    
    <img src="../images/uc02baas.jpg" alt="download"
        style="width: 40vw; max-width: 900px;"/>
    <figcaption style="text-align: center;">       
      Figure 5. The AAS information model of bridge NPB with CANOpen
    </figcaption> 
  </figure>        
</div>

<p>To ease the deployment, an amd64 Docker image for the bridge 
and a arm64 Docker image for stair CANOpen are prepared in 
<a href="https://github.com/pkgi40/p4m-projects/releases/download/ros6gbridge_uc02-b_kit_v0.1/UC02-b_kit.zip">ROS6GBridge UC02-b kit</a>
. Users can reuse other components to 
test with these two extensions. Figure 6 shows the result when triggering 
the stair CANOpen. with the following command:  </p>
<blockquote>
<p>$<code>docker run -it --net=host --rm pourer_mtcp:0.1 /app 192.168.56.11 70 1</code></p>
</blockquote>
<div align="center">       
  <figure style="display: inline-block; margin: 0 10px;">    
    <img src="../images/poureroutputb.jpg" alt="download" style="width: 100%;"/>
    <figcaption style="text-align: center;">       
      Figure 6. Output when triggering stair CANOpen
    </figcaption> 
  </figure>        
</div>

<p><span style="color:#2196f3; font-style:italic;">
<u>Note:</u> This test requires fundamentally two stairs 
<strong style="color:#2196f3">CANOpen</strong> and 
<strong style="color:#2196f3">ModbusTCP</strong>. 
</span></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">
      <p style="margin: 0 auto; text-align: center;">
        Copyright © 2025 Commisariat à l'Energie Atomique - Energies Alternatives — CEA LIST. All rights reserved.
      </p>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "search": "../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>